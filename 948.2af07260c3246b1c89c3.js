"use strict";(self.webpackChunkatomixwap=self.webpackChunkatomixwap||[]).push([[948],{1948:(e,t,s)=>{s.r(t),s.d(t,{SwapLinkForm:()=>n});var i=s(4126),a=s(2592),r=s(9182);class n{constructor(e,t,s,i,a){this.ui=document.createElement("div"),this.defaultRoyalties=t,this.submitCallback=s,this.walletConnect=i,this.algoIndexer=a,this.data={},this.isAssetCreator=!1,this.numNfts=0,this.ndfWalletAddress,this.ui.innerHTML=`<h4>Create swap link</h4>\n        <form>\n                    <div class="mb-3" id="nfts">\n                    </div>\n                    <div class="mb-3">\n                        <label for="inputAlgoAddress" class="form-label">Receiver</label>\n                        <input type="text" class="form-control" id="inputAlgoAddress"\n                            aria-describedby="AlgoAddressdHelp" required>\n                        <div id="AlgoAddressdHelp" class="form-text">Algorand Wallet Address or NFD</div>\n                    </div>\n                    <div class="mb-3">\n                        <div class="row">\n                        <label for="inputPrice" class="form-label" id="price-label">Price</label>\n                        <label for="inputPriceAssetId" class="form-label" id="nft-label" hidden>NFT to receive</label>\n                            <div class="col" id="price-div">\n                                <input type="number" class="form-control" id="inputPrice" min="0" step="1">\n                            </div>\n                            <div class="col" id="nft-div" hidden>\n                                <input type="text" class="form-control" id="inputPriceAssetId" aria-describedby="priceAssetIdHelp"\n                                    pattern="\\d*">\n                                <div id="priceAssetIdHelp" class="form-text">ASA asset ID</div>\n                            </div>\n                            <div class="col">\n                                <select class="form-select" id="inputCurrency" aria-label="Select currency">\n                                </select>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="mb-3">\n                      <div class="row">\n                        <div class="col-6">\n                          <div class="d-flex justify-content-between">\n                          <label for="inputRoyalties" class="form-label">Creator royalty</label>\n                          <span id="royaltiesValueLabel" class="royalties">0&percnt;</span>\n                      </div>\n\n                      <input type="range" class="form-range" value="${this.defaultRoyalties}" min="0" max="10" step="0.5" id="inputRoyalties"\n                          aria-describedby="royaltiesdHelp">\n                      <div id="royaltiesdHelp" class="form-text"></div>\n                        </div>\n                        <div class="col-6 position-relative">\n                        <span class="position-absolute heart" id="royaltiesLoveRed" hidden>&#10084;</span>\n                        <span class="position-absolute heart" id="royaltiesLoveGreen">&#128154;</span>\n                        \n                        </div>\n                      </div>\n                       \n                    </div>\n                    <div class="mb-3 form-check">\n                        <input type="checkbox" class="form-check-input" id="checkAcceptRisk" required>\n                        <label class="form-check-label" for="checkAcceptRisk">I accept to use this tool at my own\n                            risk</label>\n                    </div>\n                    <button type="submit" id="buttonSubmit" class="btn btn-generate fw-bold">Preview</button>\n\n\n                </form>`,this.addNFT();const r=this.ui.querySelector("#inputCurrency"),n=document.createElement("option");n.textContent="ALGO",n.value="algo",n.selected=!0,r.append(n);const l=document.createElement("option");l.textContent="NFT",l.value="nft",r.append(l);const d=document.createElement("optgroup");d.label="ASAs",r.append(d);for(const t of e){const e=document.createElement("option");e.textContent=t.name,e.value=t.assetId,d.append(e)}this.ui.querySelector("#inputRoyalties").addEventListener("input",this.royaltiesChange.bind(this),!1),this.ui.querySelector("#inputCurrency").addEventListener("change",this.currencyChange.bind(this),!1),this.ui.querySelector("form").addEventListener("submit",this.submitForm.bind(this),!1),this.ui.querySelector("#inputAlgoAddress").addEventListener("focusout",this.checkNfd.bind(this),!1),this.ui.querySelector("#inputRoyalties").dispatchEvent(new Event("input"))}addNFT(e){if(e&&e.currentTarget&&(e.currentTarget.hidden=!0),this.numNfts>=r.Z.maxNfts)return;const t=this.ui.querySelector("#nfts"),s=document.createElement("div");s.className="row mt-2",s.innerHTML=`\n      <div class="col-6">\n        <label for="inputAssetId" class="form-label">NFT</label>\n        <input type="text" class="form-control" id="inputAssetId" data-id="${this.numNfts}" aria-describedby="assetIdHelp"\n            pattern="\\d*">\n        <div id="assetIdHelp" class="form-text">ASA asset ID</div>\n      </div>\n      <div class="col-1">\n        <br>\n        <a href="javascript:void(0);" id="add-nft" hidden>\n          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-plus-square mt-3" viewBox="0 0 16 16">\n            <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>\n            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>\n          </svg>\n        </a>\n      </div>\n      <div class="col-5 text-center">\n        <img src="default.png" id="imgAssetPreview" width="auto" height="95">\n      </div>\n    `;const i=s.querySelector("#inputAssetId");0===this.numNfts&&(i.required=!0),i.addEventListener("focusout",this.assetIdFocusOut.bind(this),!1);const a=s.querySelector("#add-nft");this.numNfts<r.Z.maxNfts-1&&(a.hidden=!1,a.addEventListener("click",this.addNFT.bind(this),!1)),t.append(s),this.numNfts++}async assetIdFocusOut(e){const t=e.currentTarget;this.displayAssetInfo(t)}async displayAssetInfo(e){const t=e.parentNode.parentNode,s=t.querySelector("#assetIdHelp"),i=t.querySelector("#imgAssetPreview"),r=this.ui.querySelector("#inputRoyalties"),n=this.ui.querySelector("#royaltiesdHelp"),l=parseInt(e.value);if(isNaN(l))s.innerHTML='<span class="text-danger">Wrong asset ID format</span>',r.disabled=!1,n.textContent="";else{try{const e=await this.algoIndexer.lookupAssetByID(l).do();s.innerHTML=`<span class="text-success">${e.asset.params.name} (${e.asset.params["unit-name"]})</span>`,e.asset.params.creator===this.walletConnect.walletAddress?this.isAssetCreator=!0:this.isAssetCreator=!1}catch(e){console.error(e),s.innerHTML=`<span class="text-danger">Error: Asset with ID ${l} not found</span>`,this.isAssetCreator=!1}this.checkRoyaltiesAvailability(),(0,a.g)(l,i,200)}}async checkNfd(e){const t=e.currentTarget.value,s=this.ui.querySelector("#AlgoAddressdHelp");if(this.ndfWalletAddress=void 0,t.endsWith(".algo"))try{const e=await fetch("https://api.nf.domains/nfd/"+t+"?view=brief");if(200===e.status){const t=await e.json();t.caAlgo&&t.caAlgo.length>0?this.ndfWalletAddress=t.caAlgo[0]:t.unverifiedCaAlgo&&t.unverifiedCaAlgo.length>0?this.ndfWalletAddress=t.unverifiedCaAlgo[0]:"owned"===t.state&&t.owner&&(this.ndfWalletAddress=t.owner),this.ndfWalletAddress&&(s.innerHTML=`<span class="text-success">${this.ndfWalletAddress}</span>`)}else s.innerHTML=`<span class="text-danger">Error: NFD ${t} not found</span>`}catch(e){console.error(e),s.innerHTML='<span class="text-danger">Error: Can\'t load NFD</span>'}else i.default.isValidAddress(t)?s.textContent="Algorand Wallet Address or NFD":s.innerHTML='<span class="text-danger">Wrong wallet address format</span>'}currencyChange(e){const t=e.currentTarget.value,s=this.ui.querySelector("#nft-div"),i=this.ui.querySelector("#nft-label"),a=this.ui.querySelector("#price-div"),r=this.ui.querySelector("#price-label");"nft"===t?(s.hidden=!1,i.hidden=!1,s.querySelector("input").required=!0,a.hidden=!0,r.hidden=!0,a.querySelector("input").required=!1):(s.hidden=!0,i.hidden=!0,s.querySelector("input").required=!1,a.hidden=!1,r.hidden=!1,a.querySelector("input").required=!0),this.checkRoyaltiesAvailability()}async checkRoyaltiesAvailability(){const e=this.ui.querySelector("#inputCurrency"),t=this.ui.querySelector("#inputRoyalties"),s=this.ui.querySelector("#royaltiesdHelp"),i=this.ui.querySelector("#royaltiesLoveGreen"),a=this.ui.querySelector("#royaltiesLoveRed");let r=!1;if(this.numNfts>1){let e="";for(const t of this.ui.querySelectorAll("#inputAssetId"))if(t.value&&!isNaN(t.value))try{const s=await this.algoIndexer.lookupAssetByID(parseInt(t.value)).do();e&&e!=s.asset.params.creator&&(r=!0),e=s.asset.params.creator}catch(e){console.error(e)}}"algo"!==e.value||this.isAssetCreator||r?(t.value=0,t.disabled=!0,"algo"!==e.value?s.textContent="Royalty not available for other token than Algo":this.isAssetCreator?s.textContent="You're the creator of this asset, royalty disabled.":r&&(s.textContent="Multiple creators detected, royalty disabled."),i.hidden=!0,a.hidden=!0):(t.disabled=!1,s.textContent="",i.hidden=!1),t.dispatchEvent(new Event("input"))}royaltiesChange(e){const t=this.ui.querySelector("#inputRoyalties");this.ui.querySelector("#royaltiesValueLabel").textContent=`${t.value} %`;const s=this.ui.querySelector("#royaltiesLoveGreen"),i=this.ui.querySelector("#royaltiesLoveRed"),a=Number(t.min),r=Number(t.max),n=1+(t.value-t.min)/(t.max-t.min)*3.5;if(s.style=`font-size: ${n}rem`,t.value>a+(r-a)/2){const e=(t.value-(a+(r-a)/2))/((r-a)/2);let l="";t.value===t.max&&(l="animation: animateHeart 1.2s infinite;"),i.hidden=!1,i.style=`font-size: ${n}rem; ${l}`,s.style=`font-size: ${n}rem; opacity: ${1-e}`}else i.hidden=!0}async validate(){await this.checkRoyaltiesAvailability();const e=[];if(this.ui.querySelectorAll("#inputAssetId").forEach((async t=>{if(t.value&&!isNaN(t.value))e.push(parseInt(t.value,10)),await this.displayAssetInfo(t);else if(t.value&&isNaN(t.value))throw new Error(`Wrong format for asset id ${t.value}`)})),this.data.assetIds=e,this.data.buyerAddress=this.ui.querySelector("#inputAlgoAddress").value,this.data.price=this.ui.querySelector("#inputPrice").value,this.data.currency=this.ui.querySelector("#inputCurrency").value,this.data.royaltiesPercent=this.ui.querySelector("#inputRoyalties").value,this.data.acceptRisk=this.ui.querySelector("#checkAcceptRisk").checked,0===this.data.assetIds.length)throw new Error("No asset id provided or wrong format");if(this.data.buyerAddress.endsWith(".algo")&&!this.ndfWalletAddress)throw new Error("NFD not found");if(!this.data.buyerAddress.endsWith(".algo")&&!i.default.isValidAddress(this.data.buyerAddress))throw new Error("Algorand wallet address is not valid");if(isNaN(this.data.price))throw new Error("Price is not a number");if(isNaN(this.data.royaltiesPercent))throw new Error("Royalties value is not a number");if(!this.data.acceptRisk)throw new Error("Risk not accepted");if("nft"===this.data.currency&&isNaN(this.ui.querySelector("#inputPriceAssetId").value))throw new Error(`Wrong format for asset id ${this.ui.querySelector("#inputPriceAssetId").value}`);this.data.buyerAddress.endsWith(".algo")&&(this.data.buyerAddress=this.ndfWalletAddress),this.data.priceAssetId=parseInt(this.ui.querySelector("#inputPriceAssetId").value)}async submitForm(e){this.makeBusy(),e.preventDefault();try{await this.validate()}catch(e){return this.stopBusy(),void alert(e)}this.submitCallback&&this.submitCallback(this)}makeBusy(){const e=this.ui.querySelector("#buttonSubmit");e.disabled=!0,e.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>\n    Preview'}stopBusy(){const e=this.ui.querySelector("#buttonSubmit");e.textContent="Preview",e.disabled=!1}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QWF6RyxVQUFZLHNHQUUzQixDQUVBdUcsV0FDRSxNQUFNRSxFQUFlakgsS0FBS0MsR0FBR1UsY0FBYyxpQkFDM0NzRyxFQUFhcEcsWUFBYyxVQUMzQm9HLEVBQWE1RCxVQUFXLENBQzFCLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9hdG9taXh3YXAvLi9zcmMvc3dhcC1saW5rLWZvcm0uanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGFsZ29zZGsgZnJvbSBcImFsZ29zZGtcIjtcbmltcG9ydCB7IGxvYWRBc3NldEltYWdlIH0gZnJvbSBcIi4vYXNzZXQtZGV0YWlsc1wiO1xuaW1wb3J0IGNvbmZpZyBmcm9tIFwiLi9jb25maWcuanNcIjtcblxuZXhwb3J0IGNsYXNzIFN3YXBMaW5rRm9ybSB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIGN1cnJlbmNpZXMsXG4gICAgZGVmYXVsdFJveWFsdGllcyxcbiAgICBzdWJtaXRDYWxsYmFjayxcbiAgICB3YWxsZXRDb25uZWN0LFxuICAgIGFsZ29JbmRleGVyXG4gICkge1xuICAgIHRoaXMudWkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIHRoaXMuZGVmYXVsdFJveWFsdGllcyA9IGRlZmF1bHRSb3lhbHRpZXM7XG4gICAgdGhpcy5zdWJtaXRDYWxsYmFjayA9IHN1Ym1pdENhbGxiYWNrO1xuICAgIHRoaXMud2FsbGV0Q29ubmVjdCA9IHdhbGxldENvbm5lY3Q7XG4gICAgdGhpcy5hbGdvSW5kZXhlciA9IGFsZ29JbmRleGVyO1xuICAgIHRoaXMuZGF0YSA9IHt9O1xuICAgIHRoaXMuaXNBc3NldENyZWF0b3IgPSBmYWxzZTtcbiAgICB0aGlzLm51bU5mdHMgPSAwO1xuICAgIHRoaXMubmRmV2FsbGV0QWRkcmVzcztcblxuICAgIHRoaXMudWkuaW5uZXJIVE1MID0gYDxoND5DcmVhdGUgc3dhcCBsaW5rPC9oND5cbiAgICAgICAgPGZvcm0+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJtYi0zXCIgaWQ9XCJuZnRzXCI+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibWItM1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGZvcj1cImlucHV0QWxnb0FkZHJlc3NcIiBjbGFzcz1cImZvcm0tbGFiZWxcIj5SZWNlaXZlcjwvbGFiZWw+XG4gICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT1cInRleHRcIiBjbGFzcz1cImZvcm0tY29udHJvbFwiIGlkPVwiaW5wdXRBbGdvQWRkcmVzc1wiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJpYS1kZXNjcmliZWRieT1cIkFsZ29BZGRyZXNzZEhlbHBcIiByZXF1aXJlZD5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9XCJBbGdvQWRkcmVzc2RIZWxwXCIgY2xhc3M9XCJmb3JtLXRleHRcIj5BbGdvcmFuZCBXYWxsZXQgQWRkcmVzcyBvciBORkQ8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJtYi0zXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwicm93XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPVwiaW5wdXRQcmljZVwiIGNsYXNzPVwiZm9ybS1sYWJlbFwiIGlkPVwicHJpY2UtbGFiZWxcIj5QcmljZTwvbGFiZWw+XG4gICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPVwiaW5wdXRQcmljZUFzc2V0SWRcIiBjbGFzcz1cImZvcm0tbGFiZWxcIiBpZD1cIm5mdC1sYWJlbFwiIGhpZGRlbj5ORlQgdG8gcmVjZWl2ZTwvbGFiZWw+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbFwiIGlkPVwicHJpY2UtZGl2XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwibnVtYmVyXCIgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiBpZD1cImlucHV0UHJpY2VcIiBtaW49XCIwXCIgc3RlcD1cIjFcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29sXCIgaWQ9XCJuZnQtZGl2XCIgaGlkZGVuPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT1cInRleHRcIiBjbGFzcz1cImZvcm0tY29udHJvbFwiIGlkPVwiaW5wdXRQcmljZUFzc2V0SWRcIiBhcmlhLWRlc2NyaWJlZGJ5PVwicHJpY2VBc3NldElkSGVscFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXR0ZXJuPVwiXFxcXGQqXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9XCJwcmljZUFzc2V0SWRIZWxwXCIgY2xhc3M9XCJmb3JtLXRleHRcIj5BU0EgYXNzZXQgSUQ8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29sXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzZWxlY3QgY2xhc3M9XCJmb3JtLXNlbGVjdFwiIGlkPVwiaW5wdXRDdXJyZW5jeVwiIGFyaWEtbGFiZWw9XCJTZWxlY3QgY3VycmVuY3lcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zZWxlY3Q+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJtYi0zXCI+XG4gICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInJvd1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbC02XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJkLWZsZXgganVzdGlmeS1jb250ZW50LWJldHdlZW5cIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGZvcj1cImlucHV0Um95YWx0aWVzXCIgY2xhc3M9XCJmb3JtLWxhYmVsXCI+Q3JlYXRvciByb3lhbHR5PC9sYWJlbD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gaWQ9XCJyb3lhbHRpZXNWYWx1ZUxhYmVsXCIgY2xhc3M9XCJyb3lhbHRpZXNcIj4wJnBlcmNudDs8L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT1cInJhbmdlXCIgY2xhc3M9XCJmb3JtLXJhbmdlXCIgdmFsdWU9XCIke3RoaXMuZGVmYXVsdFJveWFsdGllc31cIiBtaW49XCIwXCIgbWF4PVwiMTBcIiBzdGVwPVwiMC41XCIgaWQ9XCJpbnB1dFJveWFsdGllc1wiXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGFyaWEtZGVzY3JpYmVkYnk9XCJyb3lhbHRpZXNkSGVscFwiPlxuICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9XCJyb3lhbHRpZXNkSGVscFwiIGNsYXNzPVwiZm9ybS10ZXh0XCI+PC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtNiBwb3NpdGlvbi1yZWxhdGl2ZVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJwb3NpdGlvbi1hYnNvbHV0ZSBoZWFydFwiIGlkPVwicm95YWx0aWVzTG92ZVJlZFwiIGhpZGRlbj4mIzEwMDg0Ozwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwicG9zaXRpb24tYWJzb2x1dGUgaGVhcnRcIiBpZD1cInJveWFsdGllc0xvdmVHcmVlblwiPiYjMTI4MTU0Ozwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm1iLTMgZm9ybS1jaGVja1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJjaGVja2JveFwiIGNsYXNzPVwiZm9ybS1jaGVjay1pbnB1dFwiIGlkPVwiY2hlY2tBY2NlcHRSaXNrXCIgcmVxdWlyZWQ+XG4gICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9XCJmb3JtLWNoZWNrLWxhYmVsXCIgZm9yPVwiY2hlY2tBY2NlcHRSaXNrXCI+SSBhY2NlcHQgdG8gdXNlIHRoaXMgdG9vbCBhdCBteSBvd25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByaXNrPC9sYWJlbD5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT1cInN1Ym1pdFwiIGlkPVwiYnV0dG9uU3VibWl0XCIgY2xhc3M9XCJidG4gYnRuLWdlbmVyYXRlIGZ3LWJvbGRcIj5QcmV2aWV3PC9idXR0b24+XG5cblxuICAgICAgICAgICAgICAgIDwvZm9ybT5gO1xuXG4gICAgLy9hZGQgbmZ0IGZvcm1cbiAgICB0aGlzLmFkZE5GVCgpO1xuXG4gICAgLy9hZGQgY3VycmVuY2llc1xuICAgIGNvbnN0IGlucHV0Q3VycmVuY3kgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjaW5wdXRDdXJyZW5jeVwiKTtcblxuICAgIC8vYWRkIGFsZ28gYnkgZGVmYXVsdFxuICAgIGNvbnN0IGFsZ29PcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwib3B0aW9uXCIpO1xuICAgIGFsZ29PcHRpb24udGV4dENvbnRlbnQgPSBcIkFMR09cIjtcbiAgICBhbGdvT3B0aW9uLnZhbHVlID0gXCJhbGdvXCI7XG4gICAgYWxnb09wdGlvbi5zZWxlY3RlZCA9IHRydWU7XG5cbiAgICBpbnB1dEN1cnJlbmN5LmFwcGVuZChhbGdvT3B0aW9uKTtcblxuICAgIC8vYWRkIG5mdCBvcHRpb25cbiAgICBjb25zdCBuZnRPcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwib3B0aW9uXCIpO1xuICAgIG5mdE9wdGlvbi50ZXh0Q29udGVudCA9IFwiTkZUXCI7XG4gICAgbmZ0T3B0aW9uLnZhbHVlID0gXCJuZnRcIjtcblxuICAgIGlucHV0Q3VycmVuY3kuYXBwZW5kKG5mdE9wdGlvbik7XG5cbiAgICAvL2FkZCBhc2Egb3B0aW9uXG4gICAgY29uc3QgYXNhT3B0R3JvdXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwib3B0Z3JvdXBcIik7XG4gICAgYXNhT3B0R3JvdXAubGFiZWwgPSBcIkFTQXNcIjtcbiAgICBpbnB1dEN1cnJlbmN5LmFwcGVuZChhc2FPcHRHcm91cCk7XG5cbiAgICBmb3IgKGNvbnN0IGN1cnJlbmN5IG9mIGN1cnJlbmNpZXMpIHtcbiAgICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJvcHRpb25cIik7XG4gICAgICBvcHRpb24udGV4dENvbnRlbnQgPSBjdXJyZW5jeS5uYW1lO1xuICAgICAgb3B0aW9uLnZhbHVlID0gY3VycmVuY3kuYXNzZXRJZDtcbiAgICAgIGFzYU9wdEdyb3VwLmFwcGVuZChvcHRpb24pO1xuICAgIH1cblxuICAgIC8vbGlzdGVuIHRvIGNoYW5nZSBldmVudHNcbiAgICB0aGlzLnVpXG4gICAgICAucXVlcnlTZWxlY3RvcihcIiNpbnB1dFJveWFsdGllc1wiKVxuICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCB0aGlzLnJveWFsdGllc0NoYW5nZS5iaW5kKHRoaXMpLCBmYWxzZSk7XG5cbiAgICB0aGlzLnVpXG4gICAgICAucXVlcnlTZWxlY3RvcihcIiNpbnB1dEN1cnJlbmN5XCIpXG4gICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCB0aGlzLmN1cnJlbmN5Q2hhbmdlLmJpbmQodGhpcyksIGZhbHNlKTtcblxuICAgIC8vbGlzdGVuIHRvIGZvcm0gc3VibWl0IGV2ZW50XG4gICAgdGhpcy51aVxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCJmb3JtXCIpXG4gICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCB0aGlzLnN1Ym1pdEZvcm0uYmluZCh0aGlzKSwgZmFsc2UpO1xuXG4gICAgLy9maW5kIG5mZFxuICAgIHRoaXMudWlcbiAgICAgIC5xdWVyeVNlbGVjdG9yKFwiI2lucHV0QWxnb0FkZHJlc3NcIilcbiAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiZm9jdXNvdXRcIiwgdGhpcy5jaGVja05mZC5iaW5kKHRoaXMpLCBmYWxzZSk7XG5cbiAgICAvL3VwZGF0ZSByb3lhbHRpZXNcbiAgICB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjaW5wdXRSb3lhbHRpZXNcIikuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoXCJpbnB1dFwiKSk7XG4gIH1cblxuICBhZGRORlQoZXZlbnQpIHtcbiAgICAvL2hpZGUgJysnIGJ1dHRvbiB0aGF0IGhhdmUgYmVlbiBqdXN0IGNsaWNrZWRcbiAgICBpZiAoZXZlbnQgJiYgZXZlbnQuY3VycmVudFRhcmdldCkge1xuICAgICAgZXZlbnQuY3VycmVudFRhcmdldC5oaWRkZW4gPSB0cnVlO1xuICAgIH1cblxuICAgIGlmICh0aGlzLm51bU5mdHMgPj0gY29uZmlnLm1heE5mdHMpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBuZnRzRGl2ID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI25mdHNcIik7XG5cbiAgICBjb25zdCBuZXdOZnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIG5ld05mdC5jbGFzc05hbWUgPSBcInJvdyBtdC0yXCI7XG4gICAgbmV3TmZ0LmlubmVySFRNTCA9IGBcbiAgICAgIDxkaXYgY2xhc3M9XCJjb2wtNlwiPlxuICAgICAgICA8bGFiZWwgZm9yPVwiaW5wdXRBc3NldElkXCIgY2xhc3M9XCJmb3JtLWxhYmVsXCI+TkZUPC9sYWJlbD5cbiAgICAgICAgPGlucHV0IHR5cGU9XCJ0ZXh0XCIgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiBpZD1cImlucHV0QXNzZXRJZFwiIGRhdGEtaWQ9XCIke3RoaXMubnVtTmZ0c31cIiBhcmlhLWRlc2NyaWJlZGJ5PVwiYXNzZXRJZEhlbHBcIlxuICAgICAgICAgICAgcGF0dGVybj1cIlxcXFxkKlwiPlxuICAgICAgICA8ZGl2IGlkPVwiYXNzZXRJZEhlbHBcIiBjbGFzcz1cImZvcm0tdGV4dFwiPkFTQSBhc3NldCBJRDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgICA8ZGl2IGNsYXNzPVwiY29sLTFcIj5cbiAgICAgICAgPGJyPlxuICAgICAgICA8YSBocmVmPVwiamF2YXNjcmlwdDp2b2lkKDApO1wiIGlkPVwiYWRkLW5mdFwiIGhpZGRlbj5cbiAgICAgICAgICA8c3ZnIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB3aWR0aD1cIjI0XCIgaGVpZ2h0PVwiMjRcIiBmaWxsPVwiY3VycmVudENvbG9yXCIgY2xhc3M9XCJiaSBiaS1wbHVzLXNxdWFyZSBtdC0zXCIgdmlld0JveD1cIjAgMCAxNiAxNlwiPlxuICAgICAgICAgICAgPHBhdGggZD1cIk0xNCAxYTEgMSAwIDAgMSAxIDF2MTJhMSAxIDAgMCAxLTEgMUgyYTEgMSAwIDAgMS0xLTFWMmExIDEgMCAwIDEgMS0xaDEyek0yIDBhMiAyIDAgMCAwLTIgMnYxMmEyIDIgMCAwIDAgMiAyaDEyYTIgMiAwIDAgMCAyLTJWMmEyIDIgMCAwIDAtMi0ySDJ6XCIvPlxuICAgICAgICAgICAgPHBhdGggZD1cIk04IDRhLjUuNSAwIDAgMSAuNS41djNoM2EuNS41IDAgMCAxIDAgMWgtM3YzYS41LjUgMCAwIDEtMSAwdi0zaC0zYS41LjUgMCAwIDEgMC0xaDN2LTNBLjUuNSAwIDAgMSA4IDR6XCIvPlxuICAgICAgICAgIDwvc3ZnPlxuICAgICAgICA8L2E+XG4gICAgICA8L2Rpdj5cbiAgICAgIDxkaXYgY2xhc3M9XCJjb2wtNSB0ZXh0LWNlbnRlclwiPlxuICAgICAgICA8aW1nIHNyYz1cImRlZmF1bHQucG5nXCIgaWQ9XCJpbWdBc3NldFByZXZpZXdcIiB3aWR0aD1cImF1dG9cIiBoZWlnaHQ9XCI5NVwiPlxuICAgICAgPC9kaXY+XG4gICAgYDtcblxuICAgIGNvbnN0IGlucHV0QXNzZXRJZCA9IG5ld05mdC5xdWVyeVNlbGVjdG9yKGAjaW5wdXRBc3NldElkYCk7XG5cbiAgICBpZiAodGhpcy5udW1OZnRzID09PSAwKSB7XG4gICAgICBpbnB1dEFzc2V0SWQucmVxdWlyZWQgPSB0cnVlO1xuICAgIH1cblxuICAgIGlucHV0QXNzZXRJZC5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgXCJmb2N1c291dFwiLFxuICAgICAgdGhpcy5hc3NldElkRm9jdXNPdXQuYmluZCh0aGlzKSxcbiAgICAgIGZhbHNlXG4gICAgKTtcblxuICAgIGNvbnN0IGFkZExpbmsgPSBuZXdOZnQucXVlcnlTZWxlY3RvcihgI2FkZC1uZnRgKTtcblxuICAgIGlmICh0aGlzLm51bU5mdHMgPCBjb25maWcubWF4TmZ0cyAtIDEpIHtcbiAgICAgIGFkZExpbmsuaGlkZGVuID0gZmFsc2U7XG4gICAgICBhZGRMaW5rLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLmFkZE5GVC5iaW5kKHRoaXMpLCBmYWxzZSk7XG4gICAgfVxuXG4gICAgbmZ0c0Rpdi5hcHBlbmQobmV3TmZ0KTtcblxuICAgIHRoaXMubnVtTmZ0cysrO1xuICB9XG5cbiAgYXN5bmMgYXNzZXRJZEZvY3VzT3V0KGV2ZW50KSB7XG4gICAgY29uc3QgaW5wdXRBc3NldElkID0gZXZlbnQuY3VycmVudFRhcmdldDtcbiAgICB0aGlzLmRpc3BsYXlBc3NldEluZm8oaW5wdXRBc3NldElkKTtcbiAgfVxuXG4gIGFzeW5jIGRpc3BsYXlBc3NldEluZm8oaW5wdXRBc3NldElkKSB7XG4gICAgY29uc3QgcGFyZW50ID0gaW5wdXRBc3NldElkLnBhcmVudE5vZGUucGFyZW50Tm9kZTtcblxuICAgIGNvbnN0IGFzc2V0SWRIZWxwID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYXNzZXRJZEhlbHBcIik7XG4gICAgY29uc3QgYXNzZXRJbWcgPSBwYXJlbnQucXVlcnlTZWxlY3RvcihcIiNpbWdBc3NldFByZXZpZXdcIik7XG4gICAgLy9jb25zdCBpbnB1dEFzc2V0SWQgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjaW5wdXRBc3NldElkXCIpO1xuICAgIGNvbnN0IGlucHV0Um95YWx0aWVzID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2lucHV0Um95YWx0aWVzXCIpO1xuICAgIGNvbnN0IHJveWFsdGllc2RIZWxwID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI3JveWFsdGllc2RIZWxwXCIpO1xuICAgIGNvbnN0IGFzc2V0SUQgPSBwYXJzZUludChpbnB1dEFzc2V0SWQudmFsdWUpO1xuXG4gICAgLy9yZXRyZWl2ZSBhc3NldCBpbmZvc1xuICAgIGlmICghaXNOYU4oYXNzZXRJRCkpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuYWxnb0luZGV4ZXIubG9va3VwQXNzZXRCeUlEKGFzc2V0SUQpLmRvKCk7XG5cbiAgICAgICAgYXNzZXRJZEhlbHAuaW5uZXJIVE1MID0gYDxzcGFuIGNsYXNzPVwidGV4dC1zdWNjZXNzXCI+JHtyZXN1bHQuYXNzZXQucGFyYW1zLm5hbWV9ICgke3Jlc3VsdC5hc3NldC5wYXJhbXNbXCJ1bml0LW5hbWVcIl19KTwvc3Bhbj5gO1xuXG4gICAgICAgIGNvbnN0IGNyZWF0b3JBZGRyZXNzID0gcmVzdWx0LmFzc2V0LnBhcmFtcy5jcmVhdG9yO1xuXG4gICAgICAgIGlmIChjcmVhdG9yQWRkcmVzcyA9PT0gdGhpcy53YWxsZXRDb25uZWN0LndhbGxldEFkZHJlc3MpIHtcbiAgICAgICAgICB0aGlzLmlzQXNzZXRDcmVhdG9yID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmlzQXNzZXRDcmVhdG9yID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICAgIGFzc2V0SWRIZWxwLmlubmVySFRNTCA9IGA8c3BhbiBjbGFzcz1cInRleHQtZGFuZ2VyXCI+RXJyb3I6IEFzc2V0IHdpdGggSUQgJHthc3NldElEfSBub3QgZm91bmQ8L3NwYW4+YDtcblxuICAgICAgICB0aGlzLmlzQXNzZXRDcmVhdG9yID0gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuY2hlY2tSb3lhbHRpZXNBdmFpbGFiaWxpdHkoKTtcblxuICAgICAgLy9sb2FkIGFzc2V0IGltYXpnZVxuICAgICAgbG9hZEFzc2V0SW1hZ2UoYXNzZXRJRCwgYXNzZXRJbWcsIDIwMCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFzc2V0SWRIZWxwLmlubmVySFRNTCA9IGA8c3BhbiBjbGFzcz1cInRleHQtZGFuZ2VyXCI+V3JvbmcgYXNzZXQgSUQgZm9ybWF0PC9zcGFuPmA7XG5cbiAgICAgIGlucHV0Um95YWx0aWVzLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICByb3lhbHRpZXNkSGVscC50ZXh0Q29udGVudCA9IFwiXCI7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgY2hlY2tOZmQoZXZlbnQpIHtcbiAgICBjb25zdCBhZGRyZXNzID0gZXZlbnQuY3VycmVudFRhcmdldC52YWx1ZTtcblxuICAgIGNvbnN0IGFkZHJlc3NIZWxwID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI0FsZ29BZGRyZXNzZEhlbHBcIik7XG5cbiAgICB0aGlzLm5kZldhbGxldEFkZHJlc3MgPSB1bmRlZmluZWQ7XG5cbiAgICBpZiAoYWRkcmVzcy5lbmRzV2l0aChcIi5hbGdvXCIpKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFwiaHR0cHM6Ly9hcGkubmYuZG9tYWlucy9uZmQvXCIgKyBhZGRyZXNzICtcIj92aWV3PWJyaWVmXCIgKTtcblxuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICBjb25zdCBqc29uID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuXG4gICAgICAgICAgaWYgKGpzb24uY2FBbGdvICYmIGpzb24uY2FBbGdvLmxlbmd0aCA+IDApe1xuICAgICAgICAgICAgdGhpcy5uZGZXYWxsZXRBZGRyZXNzID0ganNvbi5jYUFsZ29bMF07XG4gICAgICAgICAgfSBlbHNlIGlmIChqc29uLnVudmVyaWZpZWRDYUFsZ28gJiYganNvbi51bnZlcmlmaWVkQ2FBbGdvLmxlbmd0aCA+IDApe1xuICAgICAgICAgICAgdGhpcy5uZGZXYWxsZXRBZGRyZXNzID0ganNvbi51bnZlcmlmaWVkQ2FBbGdvWzBdO1xuICAgICAgICAgIH0gZWxzZSBpZiAoanNvbi5zdGF0ZSA9PT0gJ293bmVkJyAmJiBqc29uLm93bmVyKXtcbiAgICAgICAgICAgIHRoaXMubmRmV2FsbGV0QWRkcmVzcyA9IGpzb24ub3duZXI7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKHRoaXMubmRmV2FsbGV0QWRkcmVzcykge1xuICAgICAgICAgICAgYWRkcmVzc0hlbHAuaW5uZXJIVE1MID0gYDxzcGFuIGNsYXNzPVwidGV4dC1zdWNjZXNzXCI+JHt0aGlzLm5kZldhbGxldEFkZHJlc3N9PC9zcGFuPmA7XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFkZHJlc3NIZWxwLmlubmVySFRNTCA9IGA8c3BhbiBjbGFzcz1cInRleHQtZGFuZ2VyXCI+RXJyb3I6IE5GRCAke2FkZHJlc3N9IG5vdCBmb3VuZDwvc3Bhbj5gO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgICBhZGRyZXNzSGVscC5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9XCJ0ZXh0LWRhbmdlclwiPkVycm9yOiBDYW4ndCBsb2FkIE5GRDwvc3Bhbj5gO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoIWFsZ29zZGsuaXNWYWxpZEFkZHJlc3MoYWRkcmVzcykpIHtcbiAgICAgIGFkZHJlc3NIZWxwLmlubmVySFRNTCA9IGA8c3BhbiBjbGFzcz1cInRleHQtZGFuZ2VyXCI+V3Jvbmcgd2FsbGV0IGFkZHJlc3MgZm9ybWF0PC9zcGFuPmA7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFkZHJlc3NIZWxwLnRleHRDb250ZW50ID0gJ0FsZ29yYW5kIFdhbGxldCBBZGRyZXNzIG9yIE5GRCc7XG4gICAgfVxuICB9XG5cbiAgY3VycmVuY3lDaGFuZ2UoZXZlbnQpIHtcbiAgICBjb25zdCBjdXJyZW5jeSA9IGV2ZW50LmN1cnJlbnRUYXJnZXQudmFsdWU7XG5cbiAgICBjb25zdCBuZnRJbnB1dCA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNuZnQtZGl2XCIpO1xuICAgIGNvbnN0IG5mdExhYmVsID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI25mdC1sYWJlbFwiKTtcbiAgICBjb25zdCBwcmljZUlucHV0ID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI3ByaWNlLWRpdlwiKTtcbiAgICBjb25zdCBwcmljZUxhYmVsID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI3ByaWNlLWxhYmVsXCIpO1xuXG4gICAgaWYgKGN1cnJlbmN5ID09PSBcIm5mdFwiKSB7XG4gICAgICBuZnRJbnB1dC5oaWRkZW4gPSBmYWxzZTtcbiAgICAgIG5mdExhYmVsLmhpZGRlbiA9IGZhbHNlO1xuICAgICAgbmZ0SW5wdXQucXVlcnlTZWxlY3RvcihcImlucHV0XCIpLnJlcXVpcmVkID0gdHJ1ZTtcblxuICAgICAgcHJpY2VJbnB1dC5oaWRkZW4gPSB0cnVlO1xuICAgICAgcHJpY2VMYWJlbC5oaWRkZW4gPSB0cnVlO1xuICAgICAgcHJpY2VJbnB1dC5xdWVyeVNlbGVjdG9yKFwiaW5wdXRcIikucmVxdWlyZWQgPSBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgbmZ0SW5wdXQuaGlkZGVuID0gdHJ1ZTtcbiAgICAgIG5mdExhYmVsLmhpZGRlbiA9IHRydWU7XG4gICAgICBuZnRJbnB1dC5xdWVyeVNlbGVjdG9yKFwiaW5wdXRcIikucmVxdWlyZWQgPSBmYWxzZTtcblxuICAgICAgcHJpY2VJbnB1dC5oaWRkZW4gPSBmYWxzZTtcbiAgICAgIHByaWNlTGFiZWwuaGlkZGVuID0gZmFsc2U7XG4gICAgICBwcmljZUlucHV0LnF1ZXJ5U2VsZWN0b3IoXCJpbnB1dFwiKS5yZXF1aXJlZCA9IHRydWU7XG4gICAgfVxuXG4gICAgdGhpcy5jaGVja1JveWFsdGllc0F2YWlsYWJpbGl0eSgpO1xuICB9XG5cbiAgYXN5bmMgY2hlY2tSb3lhbHRpZXNBdmFpbGFiaWxpdHkoKSB7XG4gICAgY29uc3QgaW5wdXRDdXJyZW5jeSA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNpbnB1dEN1cnJlbmN5XCIpO1xuICAgIGNvbnN0IGlucHV0Um95YWx0aWVzID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2lucHV0Um95YWx0aWVzXCIpO1xuICAgIGNvbnN0IHJveWFsdGllc2RIZWxwID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI3JveWFsdGllc2RIZWxwXCIpO1xuICAgIGNvbnN0IGdyZWVuSGVhcnQgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjcm95YWx0aWVzTG92ZUdyZWVuXCIpO1xuICAgIGNvbnN0IHJlZEhlYXJ0ID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI3JveWFsdGllc0xvdmVSZWRcIik7XG5cbiAgICAvL2lmIHRoZXJlIGlmIG11bHRpcGxlIGFzc2V0cywgY2hlY2sgaWYgdGhleSdyZSBmcm9tIG11bHRpcGxlIGNyZWF0b3JzXG4gICAgbGV0IG11bHRpcGxlQ3JlYXRvcnMgPSBmYWxzZTtcblxuICAgIGlmICh0aGlzLm51bU5mdHMgPiAxKSB7XG4gICAgICBjb25zdCBhc3NldElkcyA9IFtdO1xuXG4gICAgICBsZXQgcHJldkNyZWF0b3IgPSBcIlwiO1xuXG4gICAgICBmb3IgKGNvbnN0IGUgb2YgdGhpcy51aS5xdWVyeVNlbGVjdG9yQWxsKFwiI2lucHV0QXNzZXRJZFwiKSkge1xuICAgICAgICBpZiAoZS52YWx1ZSAmJiAhaXNOYU4oZS52YWx1ZSkpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5hbGdvSW5kZXhlclxuICAgICAgICAgICAgICAubG9va3VwQXNzZXRCeUlEKHBhcnNlSW50KGUudmFsdWUpKVxuICAgICAgICAgICAgICAuZG8oKTtcblxuICAgICAgICAgICAgICBpZiAocHJldkNyZWF0b3IgJiYgcHJldkNyZWF0b3IgIT0gcmVzdWx0LmFzc2V0LnBhcmFtcy5jcmVhdG9yKSB7XG4gICAgICAgICAgICAgIG11bHRpcGxlQ3JlYXRvcnMgPSB0cnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBwcmV2Q3JlYXRvciA9IHJlc3VsdC5hc3NldC5wYXJhbXMuY3JlYXRvcjtcbiAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cblxuICAgIGlmIChcbiAgICAgIGlucHV0Q3VycmVuY3kudmFsdWUgIT09IFwiYWxnb1wiIHx8XG4gICAgICB0aGlzLmlzQXNzZXRDcmVhdG9yIHx8XG4gICAgICBtdWx0aXBsZUNyZWF0b3JzXG4gICAgKSB7XG4gICAgICBpbnB1dFJveWFsdGllcy52YWx1ZSA9IDA7XG4gICAgICBpbnB1dFJveWFsdGllcy5kaXNhYmxlZCA9IHRydWU7XG5cbiAgICAgIGlmIChpbnB1dEN1cnJlbmN5LnZhbHVlICE9PSBcImFsZ29cIikge1xuICAgICAgICByb3lhbHRpZXNkSGVscC50ZXh0Q29udGVudCA9XG4gICAgICAgICAgXCJSb3lhbHR5IG5vdCBhdmFpbGFibGUgZm9yIG90aGVyIHRva2VuIHRoYW4gQWxnb1wiO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLmlzQXNzZXRDcmVhdG9yKSB7XG4gICAgICAgIHJveWFsdGllc2RIZWxwLnRleHRDb250ZW50ID1cbiAgICAgICAgICBcIllvdSdyZSB0aGUgY3JlYXRvciBvZiB0aGlzIGFzc2V0LCByb3lhbHR5IGRpc2FibGVkLlwiO1xuICAgICAgfSBlbHNlIGlmIChtdWx0aXBsZUNyZWF0b3JzKSB7XG4gICAgICAgIHJveWFsdGllc2RIZWxwLnRleHRDb250ZW50ID1cbiAgICAgICAgICBcIk11bHRpcGxlIGNyZWF0b3JzIGRldGVjdGVkLCByb3lhbHR5IGRpc2FibGVkLlwiO1xuICAgICAgfVxuXG4gICAgICBncmVlbkhlYXJ0LmhpZGRlbiA9IHRydWU7XG4gICAgICByZWRIZWFydC5oaWRkZW4gPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICAvL2lucHV0Um95YWx0aWVzLnZhbHVlID0gdGhpcy5kZWZhdWx0Um95YWx0aWVzO1xuICAgICAgaW5wdXRSb3lhbHRpZXMuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIHJveWFsdGllc2RIZWxwLnRleHRDb250ZW50ID0gXCJcIjtcbiAgICAgIGdyZWVuSGVhcnQuaGlkZGVuID0gZmFsc2U7XG4gICAgfVxuXG4gICAgaW5wdXRSb3lhbHRpZXMuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoXCJpbnB1dFwiKSk7XG4gIH1cblxuICByb3lhbHRpZXNDaGFuZ2UoZXZlbnQpIHtcbiAgICBjb25zdCByb3lhbHRpZXNTbGlkZXIgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjaW5wdXRSb3lhbHRpZXNcIik7XG5cbiAgICB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBcIiNyb3lhbHRpZXNWYWx1ZUxhYmVsXCJcbiAgICApLnRleHRDb250ZW50ID0gYCR7cm95YWx0aWVzU2xpZGVyLnZhbHVlfSAlYDtcblxuICAgIGNvbnN0IGdyZWVuSGVhcnQgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjcm95YWx0aWVzTG92ZUdyZWVuXCIpO1xuICAgIGNvbnN0IHJlZEhlYXJ0ID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI3JveWFsdGllc0xvdmVSZWRcIik7XG5cbiAgICBjb25zdCBtaW5Gb250U2l6ZSA9IDEuMDtcbiAgICBjb25zdCBtYXhGb250U2l6ZSA9IDQuNTtcbiAgICBjb25zdCBzbGlkZXJNaW4gPSBOdW1iZXIocm95YWx0aWVzU2xpZGVyLm1pbik7XG4gICAgY29uc3Qgc2xpZGVyTWF4ID0gTnVtYmVyKHJveWFsdGllc1NsaWRlci5tYXgpO1xuXG4gICAgY29uc3QgZm9udFNpemUgPVxuICAgICAgbWluRm9udFNpemUgK1xuICAgICAgKG1heEZvbnRTaXplIC0gbWluRm9udFNpemUpICpcbiAgICAgICAgKChyb3lhbHRpZXNTbGlkZXIudmFsdWUgLSByb3lhbHRpZXNTbGlkZXIubWluKSAvXG4gICAgICAgICAgKHJveWFsdGllc1NsaWRlci5tYXggLSByb3lhbHRpZXNTbGlkZXIubWluKSk7XG5cbiAgICBncmVlbkhlYXJ0LnN0eWxlID0gYGZvbnQtc2l6ZTogJHtmb250U2l6ZX1yZW1gO1xuXG4gICAgaWYgKHJveWFsdGllc1NsaWRlci52YWx1ZSA+IHNsaWRlck1pbiArIChzbGlkZXJNYXggLSBzbGlkZXJNaW4pIC8gMikge1xuICAgICAgY29uc3QgcmVkSGVhcnRPcGFjaXR5ID1cbiAgICAgICAgKHJveWFsdGllc1NsaWRlci52YWx1ZSAtIChzbGlkZXJNaW4gKyAoc2xpZGVyTWF4IC0gc2xpZGVyTWluKSAvIDIpKSAvXG4gICAgICAgICgoc2xpZGVyTWF4IC0gc2xpZGVyTWluKSAvIDIpO1xuXG4gICAgICBsZXQgYW5pbWF0aW9uID0gXCJcIjtcbiAgICAgIGlmIChyb3lhbHRpZXNTbGlkZXIudmFsdWUgPT09IHJveWFsdGllc1NsaWRlci5tYXgpIHtcbiAgICAgICAgYW5pbWF0aW9uID0gXCJhbmltYXRpb246IGFuaW1hdGVIZWFydCAxLjJzIGluZmluaXRlO1wiO1xuICAgICAgfVxuXG4gICAgICByZWRIZWFydC5oaWRkZW4gPSBmYWxzZTtcbiAgICAgIHJlZEhlYXJ0LnN0eWxlID0gYGZvbnQtc2l6ZTogJHtmb250U2l6ZX1yZW07ICR7YW5pbWF0aW9ufWA7XG4gICAgICBncmVlbkhlYXJ0LnN0eWxlID0gYGZvbnQtc2l6ZTogJHtmb250U2l6ZX1yZW07IG9wYWNpdHk6ICR7XG4gICAgICAgIDEgLSByZWRIZWFydE9wYWNpdHlcbiAgICAgIH1gO1xuICAgIH0gZWxzZSB7XG4gICAgICByZWRIZWFydC5oaWRkZW4gPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHZhbGlkYXRlKCkge1xuXG4gICAgYXdhaXQgdGhpcy5jaGVja1JveWFsdGllc0F2YWlsYWJpbGl0eSgpO1xuXG4gICAgY29uc3QgYXNzZXRJZHMgPSBbXTtcbiAgICB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3JBbGwoXCIjaW5wdXRBc3NldElkXCIpLmZvckVhY2goYXN5bmMgKGUpID0+IHtcbiAgICAgIGlmIChlLnZhbHVlICYmICFpc05hTihlLnZhbHVlKSkge1xuICAgICAgICBhc3NldElkcy5wdXNoKHBhcnNlSW50KGUudmFsdWUsIDEwKSk7XG4gICAgICAgIGF3YWl0IHRoaXMuZGlzcGxheUFzc2V0SW5mbyhlKTtcbiAgICAgIH0gZWxzZSBpZiAoZS52YWx1ZSAmJiBpc05hTihlLnZhbHVlKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFdyb25nIGZvcm1hdCBmb3IgYXNzZXQgaWQgJHtlLnZhbHVlfWApO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5kYXRhLmFzc2V0SWRzID0gYXNzZXRJZHM7XG4gICAgdGhpcy5kYXRhLmJ1eWVyQWRkcmVzcyA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNpbnB1dEFsZ29BZGRyZXNzXCIpLnZhbHVlO1xuICAgIHRoaXMuZGF0YS5wcmljZSA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNpbnB1dFByaWNlXCIpLnZhbHVlO1xuICAgIHRoaXMuZGF0YS5jdXJyZW5jeSA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNpbnB1dEN1cnJlbmN5XCIpLnZhbHVlO1xuICAgIHRoaXMuZGF0YS5yb3lhbHRpZXNQZXJjZW50ID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2lucHV0Um95YWx0aWVzXCIpLnZhbHVlO1xuICAgIHRoaXMuZGF0YS5hY2NlcHRSaXNrID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2NoZWNrQWNjZXB0Umlza1wiKS5jaGVja2VkO1xuXG4gICAgXG5cbiAgICBpZiAodGhpcy5kYXRhLmFzc2V0SWRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gYXNzZXQgaWQgcHJvdmlkZWQgb3Igd3JvbmcgZm9ybWF0XCIpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5kYXRhLmJ1eWVyQWRkcmVzcy5lbmRzV2l0aCgnLmFsZ28nKSAmJiAhdGhpcy5uZGZXYWxsZXRBZGRyZXNzKXtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIk5GRCBub3QgZm91bmRcIik7XG4gICAgfSBlbHNlIGlmICghdGhpcy5kYXRhLmJ1eWVyQWRkcmVzcy5lbmRzV2l0aCgnLmFsZ28nKSAmJiAhYWxnb3Nkay5pc1ZhbGlkQWRkcmVzcyh0aGlzLmRhdGEuYnV5ZXJBZGRyZXNzKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQWxnb3JhbmQgd2FsbGV0IGFkZHJlc3MgaXMgbm90IHZhbGlkXCIpO1xuICAgIH0gZWxzZSBpZiAoaXNOYU4odGhpcy5kYXRhLnByaWNlKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUHJpY2UgaXMgbm90IGEgbnVtYmVyXCIpO1xuICAgIH0gZWxzZSBpZiAoaXNOYU4odGhpcy5kYXRhLnJveWFsdGllc1BlcmNlbnQpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJSb3lhbHRpZXMgdmFsdWUgaXMgbm90IGEgbnVtYmVyXCIpO1xuICAgIH0gZWxzZSBpZiAoIXRoaXMuZGF0YS5hY2NlcHRSaXNrKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJSaXNrIG5vdCBhY2NlcHRlZFwiKTtcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgdGhpcy5kYXRhLmN1cnJlbmN5ID09PSBcIm5mdFwiICYmXG4gICAgICBpc05hTih0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjaW5wdXRQcmljZUFzc2V0SWRcIikudmFsdWUpXG4gICAgKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBXcm9uZyBmb3JtYXQgZm9yIGFzc2V0IGlkICR7XG4gICAgICAgICAgdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2lucHV0UHJpY2VBc3NldElkXCIpLnZhbHVlXG4gICAgICAgIH1gXG4gICAgICApO1xuICAgIH0gXG5cbiAgICBpZiAodGhpcy5kYXRhLmJ1eWVyQWRkcmVzcy5lbmRzV2l0aCgnLmFsZ28nKSl7XG4gICAgICB0aGlzLmRhdGEuYnV5ZXJBZGRyZXNzID0gdGhpcy5uZGZXYWxsZXRBZGRyZXNzO1xuICAgIH1cblxuICAgIHRoaXMuZGF0YS5wcmljZUFzc2V0SWQgPSBwYXJzZUludChcbiAgICAgIHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNpbnB1dFByaWNlQXNzZXRJZFwiKS52YWx1ZVxuICAgICk7XG5cbiAgICBcbiAgfVxuXG4gIGFzeW5jIHN1Ym1pdEZvcm0oZXZlbnQpIHtcblxuICAgIHRoaXMubWFrZUJ1c3koKTtcblxuICAgIC8vY2FuY2VsIGRlZmF1bHQgYmVoYXZpb3VyIHdoZW4gc3VibWl0aW5nIGEgZm9ybVxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy52YWxpZGF0ZSgpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgdGhpcy5zdG9wQnVzeSgpO1xuICAgICAgYWxlcnQoZXJyKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5zdWJtaXRDYWxsYmFjaykge1xuICAgICAgdGhpcy5zdWJtaXRDYWxsYmFjayh0aGlzKTtcbiAgICB9XG4gIH1cblxuICBtYWtlQnVzeSgpIHtcbiAgICBjb25zdCBzdWJtaXRCdXR0b24gPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjYnV0dG9uU3VibWl0XCIpO1xuICAgIHN1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG5cbiAgICBzdWJtaXRCdXR0b24uaW5uZXJIVE1MID0gYDxzcGFuIGNsYXNzPVwic3Bpbm5lci1ib3JkZXIgc3Bpbm5lci1ib3JkZXItc21cIiByb2xlPVwic3RhdHVzXCIgYXJpYS1oaWRkZW49XCJ0cnVlXCI+PC9zcGFuPlxuICAgIFByZXZpZXdgO1xuICB9XG5cbiAgc3RvcEJ1c3koKSB7XG4gICAgY29uc3Qgc3VibWl0QnV0dG9uID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2J1dHRvblN1Ym1pdFwiKTtcbiAgICBzdWJtaXRCdXR0b24udGV4dENvbnRlbnQgPSBcIlByZXZpZXdcIjtcbiAgICBzdWJtaXRCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIlN3YXBMaW5rRm9ybSIsImNvbnN0cnVjdG9yIiwiY3VycmVuY2llcyIsImRlZmF1bHRSb3lhbHRpZXMiLCJzdWJtaXRDYWxsYmFjayIsIndhbGxldENvbm5lY3QiLCJhbGdvSW5kZXhlciIsInRoaXMiLCJ1aSIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImRhdGEiLCJpc0Fzc2V0Q3JlYXRvciIsIm51bU5mdHMiLCJuZGZXYWxsZXRBZGRyZXNzIiwiaW5uZXJIVE1MIiwiYWRkTkZUIiwiaW5wdXRDdXJyZW5jeSIsInF1ZXJ5U2VsZWN0b3IiLCJhbGdvT3B0aW9uIiwidGV4dENvbnRlbnQiLCJ2YWx1ZSIsInNlbGVjdGVkIiwiYXBwZW5kIiwibmZ0T3B0aW9uIiwiYXNhT3B0R3JvdXAiLCJsYWJlbCIsImN1cnJlbmN5Iiwib3B0aW9uIiwibmFtZSIsImFzc2V0SWQiLCJhZGRFdmVudExpc3RlbmVyIiwicm95YWx0aWVzQ2hhbmdlIiwiYmluZCIsImN1cnJlbmN5Q2hhbmdlIiwic3VibWl0Rm9ybSIsImNoZWNrTmZkIiwiZGlzcGF0Y2hFdmVudCIsIkV2ZW50IiwiZXZlbnQiLCJjdXJyZW50VGFyZ2V0IiwiaGlkZGVuIiwibmZ0c0RpdiIsIm5ld05mdCIsImNsYXNzTmFtZSIsImlucHV0QXNzZXRJZCIsInJlcXVpcmVkIiwiYXNzZXRJZEZvY3VzT3V0IiwiYWRkTGluayIsImFzeW5jIiwiZGlzcGxheUFzc2V0SW5mbyIsInBhcmVudCIsInBhcmVudE5vZGUiLCJhc3NldElkSGVscCIsImFzc2V0SW1nIiwiaW5wdXRSb3lhbHRpZXMiLCJyb3lhbHRpZXNkSGVscCIsImFzc2V0SUQiLCJwYXJzZUludCIsImlzTmFOIiwiZGlzYWJsZWQiLCJyZXN1bHQiLCJsb29rdXBBc3NldEJ5SUQiLCJkbyIsImFzc2V0IiwicGFyYW1zIiwiY3JlYXRvciIsIndhbGxldEFkZHJlc3MiLCJlcnIiLCJjb25zb2xlIiwiZXJyb3IiLCJjaGVja1JveWFsdGllc0F2YWlsYWJpbGl0eSIsImFkZHJlc3MiLCJhZGRyZXNzSGVscCIsInVuZGVmaW5lZCIsImVuZHNXaXRoIiwicmVzcG9uc2UiLCJmZXRjaCIsInN0YXR1cyIsImpzb24iLCJjYUFsZ28iLCJsZW5ndGgiLCJ1bnZlcmlmaWVkQ2FBbGdvIiwic3RhdGUiLCJvd25lciIsIm5mdElucHV0IiwibmZ0TGFiZWwiLCJwcmljZUlucHV0IiwicHJpY2VMYWJlbCIsImdyZWVuSGVhcnQiLCJyZWRIZWFydCIsIm11bHRpcGxlQ3JlYXRvcnMiLCJwcmV2Q3JlYXRvciIsImUiLCJxdWVyeVNlbGVjdG9yQWxsIiwicm95YWx0aWVzU2xpZGVyIiwic2xpZGVyTWluIiwiTnVtYmVyIiwibWluIiwic2xpZGVyTWF4IiwibWF4IiwiZm9udFNpemUiLCJzdHlsZSIsInJlZEhlYXJ0T3BhY2l0eSIsImFuaW1hdGlvbiIsImFzc2V0SWRzIiwiZm9yRWFjaCIsInB1c2giLCJFcnJvciIsImJ1eWVyQWRkcmVzcyIsInByaWNlIiwicm95YWx0aWVzUGVyY2VudCIsImFjY2VwdFJpc2siLCJjaGVja2VkIiwicHJpY2VBc3NldElkIiwibWFrZUJ1c3kiLCJwcmV2ZW50RGVmYXVsdCIsInZhbGlkYXRlIiwic3RvcEJ1c3kiLCJhbGVydCIsInN1Ym1pdEJ1dHRvbiJdLCJzb3VyY2VSb290IjoiIn0=
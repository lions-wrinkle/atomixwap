"use strict";(self.webpackChunkatomixwap=self.webpackChunkatomixwap||[]).push([[441],{9441:(e,s,n)=>{n.r(s),n.d(s,{SwapLinkAccept:()=>l});var t=n(5984),a=n(4050),i=n.n(a),r=n(2592);class l{constructor(e,s,n,t){this.walletConnect=s,this.algodClient=n,this.algoIndexer=t,this.ui=document.createElement("div"),this.fields={},this.signedTransferTxs,this.signedOptinCurrencyTx,this.resolveData(e)}async resolveData(e){const s=atob(e),n=JSON.parse(s);console.log(n),this.signedTransferTxs=n.signedTransferTxs.map((e=>t.X.base64ToSignedTx(e)));const a=this.signedTransferTxs.map((e=>i().decodeSignedTransaction(e)));n.signedOptinCurrencyTx&&(this.signedOptinCurrencyTx=t.X.base64ToSignedTx(n.signedOptinCurrencyTx)),this.fields={assetIds:a.map((e=>e.txn.assetIndex)),sellerAddress:i().encodeAddress(a[0].txn.from.publicKey),buyerAddress:i().encodeAddress(a[0].txn.to.publicKey),price:n.price,currency:n.currency,royalties:n.royalties,groupID:a[0].txn.group,firstRound:a[0].txn.firstRound,lastRound:a[0].txn.lastRound},(await this.algodClient.status().do())["last-round"]>=this.fields.lastRound?this.ui.innerHTML='<h4>Accept swap</h4>\n        <div class="alert alert-danger" role="alert">This link expired.</div>':this.fields.buyerAddress!==this.walletConnect.walletAddress?this.ui.innerHTML=`<h4>Accept swap</h4>\n        <div class="alert alert-warning" role="alert">This swap can only be accepted by the following wallet:<br><span style="word-break: break-all;">${this.fields.buyerAddress}</span></div>`:(this.ui.innerHTML="<h4>Accept swap</h4>\n        Loading...",this.swapLinkManager=new t.X(this.walletConnect,this.algodClient,this.algoIndexer),this.generateTransactions())}async generateTransactions(){try{await this.swapLinkManager.generateTransactions(this.fields)}catch(e){this.ui.innerHTML=`<h4>Accept swap</h4>\n        <div class="alert alert-danger" role="alert">${e.message}</div>`}this.displayUI()}displayUI(){const e=this.swapLinkManager.transactions,s=e.assetTransfers.map((e=>e.assetIndex)),n=(i().encodeAddress(e.assetTransfers[0].to.publicKey),i().encodeAddress(e.assetTransfers[0].from.publicKey));let t="";if(e.payment){let s,a=e.payment.amount;if("pay"===e.payment.type)a/=1e6,s="ALGO";else{let e="";360019122===this.swapLinkManager.currencyAsset.index&&(e="&#127844; "),s=`${this.swapLinkManager.currencyAsset.params["unit-name"]} ${e}(ASA ${this.swapLinkManager.currencyAsset.index})`}t=`<li>You'll send <span class="price">${a} ${s}</span><br>\n      <span class="wallet-info">TO ${n}</span></li>`}const a=this.swapLinkManager.assets.map((e=>`<strong><a href="https://www.nftexplorer.app/asset/${e.index}" target="_blank">${e.index}</a></strong> (${e.params.name})`));if(this.ui.innerHTML=`<h4>Accept swap</h4>\n        <div class="row">\n            <div class="col-md-6">\n              <ul>\n                ${t}\n                <li>You'll receive asset${a.length>1?"s":""} ${a.join(", ")}</li>\n              </ul>\n            </div>\n            <div class="col-md-6 ">\n                <img src="default.png" id="imgAssetPreview" class="img-fluid">\n            </div>\n        </div>\n        <form>\n            <div class="mb-3 form-check">\n                <input type="checkbox" class="form-check-input" id="checkAcceptRisk" required>\n                <label class="form-check-label" for="checkAcceptRisk">I accept to use this tool at my own\n                    risk</label>\n            </div>\n            \n            <button type="submit" class="btn btn-generate fw-bold" id="buttonAccept">Accept & sign</button>\n        </form>`,this.ui.querySelector("form").addEventListener("submit",this.submitAccept.bind(this)),e.royaltiesPayment){const s=this.ui.querySelector("ul"),n=document.createElement("li");let t,a=e.royaltiesPayment.amount;"pay"===e.royaltiesPayment.type?(a/=1e6,t="ALGO"):t=e.royaltiesPayment.assetIndex;const r=i().encodeAddress(e.royaltiesPayment.to.publicKey);n.innerHTML=`You'll send <span class="price">${a} ${t}</span> to asset's creator &#128154;<br>\n      <span class="wallet-info">TO ${r}</span>`,s.append(n)}(0,r.g)(s[0],this.ui.querySelector("#imgAssetPreview"),512)}async submitAccept(e){e.preventDefault();const s=this.ui.querySelector("#buttonAccept");s.disabled=!0,s.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>\n    Waiting for signatures...',this.swapLinkManager.signAndCommitTransactions(this.signedTransferTxs,this.signedOptinCurrencyTx,(()=>{s.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>\n        Sending transactions...'}),(()=>{s.hidden=!0;const e=this.swapLinkManager.assets.map((e=>`<a href="https://www.nftexplorer.app/asset/${e.index}" target="_blank">${e.index}</a> (${e.params.name})`));this.ui.innerHTML=`<h4>Swapped ðŸ¥³</h4>\n        You received asset${e.length>1?"s":""} ${e.join(", ")}.`}),(e=>{console.error(e),s.hidden=!0,this.ui.innerHTML=`<h4>Accept swap</h4>\n            <div class="alert alert-danger" role="alert">Error:<br>${e}</div>`}))}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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VUFBWSxrREFDQWtCLEVBQVVJLE9BQVMsRUFBSSxJQUFNLE1BQU1KLEVBQVVLLEtBQUssUUFBUSxJQUUvRW5CLElBQ0MxQixRQUFROEQsTUFBTXBDLEdBR2RnQyxFQUFhRyxRQUFTLEVBRXRCM0UsS0FBS0MsR0FBR21DLFVBQVksNEZBQ3lDSSxTQUFXLEdBRzlFLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9hdG9taXh3YXAvLi9zcmMvc3dhcC1saW5rLWFjY2VwdC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTd2FwTGlua01hbmFnZXIgfSBmcm9tIFwiLi9zd2FwLWxpbmstbWFuYWdlclwiO1xuaW1wb3J0IGFsZ29zZGsgZnJvbSBcImFsZ29zZGtcIjtcbmltcG9ydCB7IGxvYWRBc3NldEltYWdlIH0gZnJvbSBcIi4vYXNzZXQtZGV0YWlsc1wiO1xuXG5leHBvcnQgY2xhc3MgU3dhcExpbmtBY2NlcHQge1xuICBjb25zdHJ1Y3Rvcihzd2FwRGF0YSwgd2FsbGV0Q29ubmVjdCwgYWxnb2RDbGllbnQsIGFsZ29JbmRleGVyKSB7XG4gICAgdGhpcy53YWxsZXRDb25uZWN0ID0gd2FsbGV0Q29ubmVjdDtcbiAgICB0aGlzLmFsZ29kQ2xpZW50ID0gYWxnb2RDbGllbnQ7XG4gICAgdGhpcy5hbGdvSW5kZXhlciA9IGFsZ29JbmRleGVyO1xuXG4gICAgdGhpcy51aSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cbiAgICB0aGlzLmZpZWxkcyA9IHt9O1xuICAgIHRoaXMuc2lnbmVkVHJhbnNmZXJUeHM7XG4gICAgdGhpcy5zaWduZWRPcHRpbkN1cnJlbmN5VHg7XG5cbiAgICB0aGlzLnJlc29sdmVEYXRhKHN3YXBEYXRhKTtcbiAgfVxuXG4gIGFzeW5jIHJlc29sdmVEYXRhKHN3YXBEYXRhKSB7XG4gICAgLy9kZWNvZGUgZGF0YVxuICAgIGNvbnN0IGRlY29kZWREYXRhID0gYXRvYihzd2FwRGF0YSk7XG4gICAgY29uc3QganNvbkRhdGEgPSBKU09OLnBhcnNlKGRlY29kZWREYXRhKTtcblxuICAgIGNvbnNvbGUubG9nKGpzb25EYXRhKVxuXG4gICAgdGhpcy5zaWduZWRUcmFuc2ZlclR4cyA9IGpzb25EYXRhLnNpZ25lZFRyYW5zZmVyVHhzLm1hcCgodHgpID0+IHtcbiAgICAgIHJldHVybiBTd2FwTGlua01hbmFnZXIuYmFzZTY0VG9TaWduZWRUeCh0eCk7XG4gICAgfSk7XG5cbiAgICBjb25zdCBkZWNvZGVkU2lnbmVkVHJhbnNhY3Rpb25zID0gdGhpcy5zaWduZWRUcmFuc2ZlclR4cy5tYXAoKHR4KSA9PiB7XG4gICAgICByZXR1cm4gYWxnb3Nkay5kZWNvZGVTaWduZWRUcmFuc2FjdGlvbih0eCk7XG4gICAgfSk7XG5cbiAgICBpZiAoanNvbkRhdGEuc2lnbmVkT3B0aW5DdXJyZW5jeVR4KSB7XG4gICAgICB0aGlzLnNpZ25lZE9wdGluQ3VycmVuY3lUeCA9IFN3YXBMaW5rTWFuYWdlci5iYXNlNjRUb1NpZ25lZFR4KFxuICAgICAgICBqc29uRGF0YS5zaWduZWRPcHRpbkN1cnJlbmN5VHhcbiAgICAgICk7XG4gICAgfVxuXG4gICAgdGhpcy5maWVsZHMgPSB7XG4gICAgICBhc3NldElkczogZGVjb2RlZFNpZ25lZFRyYW5zYWN0aW9ucy5tYXAoKHR4KSA9PiB0eC50eG4uYXNzZXRJbmRleCksXG4gICAgICBzZWxsZXJBZGRyZXNzOiBhbGdvc2RrLmVuY29kZUFkZHJlc3MoXG4gICAgICAgIGRlY29kZWRTaWduZWRUcmFuc2FjdGlvbnNbMF0udHhuLmZyb20ucHVibGljS2V5XG4gICAgICApLFxuICAgICAgYnV5ZXJBZGRyZXNzOiBhbGdvc2RrLmVuY29kZUFkZHJlc3MoXG4gICAgICAgIGRlY29kZWRTaWduZWRUcmFuc2FjdGlvbnNbMF0udHhuLnRvLnB1YmxpY0tleVxuICAgICAgKSxcbiAgICAgIHByaWNlOiBqc29uRGF0YS5wcmljZSxcbiAgICAgIGN1cnJlbmN5OiBqc29uRGF0YS5jdXJyZW5jeSxcbiAgICAgIHJveWFsdGllczoganNvbkRhdGEucm95YWx0aWVzLFxuICAgICAgZ3JvdXBJRDogZGVjb2RlZFNpZ25lZFRyYW5zYWN0aW9uc1swXS50eG4uZ3JvdXAsXG4gICAgICBmaXJzdFJvdW5kOiBkZWNvZGVkU2lnbmVkVHJhbnNhY3Rpb25zWzBdLnR4bi5maXJzdFJvdW5kLFxuICAgICAgbGFzdFJvdW5kOiBkZWNvZGVkU2lnbmVkVHJhbnNhY3Rpb25zWzBdLnR4bi5sYXN0Um91bmQsXG4gICAgfTtcblxuICAgIC8vbG9hZCBjdXJyZW50IGJsb2NrXG4gICAgY29uc3Qgbm9kZVN0YXR1cyA9IGF3YWl0IHRoaXMuYWxnb2RDbGllbnQuc3RhdHVzKCkuZG8oKTtcbiAgICBjb25zdCBsYXN0Um91bmQgPSBub2RlU3RhdHVzW1wibGFzdC1yb3VuZFwiXTtcblxuICAgIGlmIChsYXN0Um91bmQgPj0gdGhpcy5maWVsZHMubGFzdFJvdW5kKSB7XG4gICAgICB0aGlzLnVpLmlubmVySFRNTCA9IGA8aDQ+QWNjZXB0IHN3YXA8L2g0PlxuICAgICAgICA8ZGl2IGNsYXNzPVwiYWxlcnQgYWxlcnQtZGFuZ2VyXCIgcm9sZT1cImFsZXJ0XCI+VGhpcyBsaW5rIGV4cGlyZWQuPC9kaXY+YDtcbiAgICB9IGVsc2UgaWYgKHRoaXMuZmllbGRzLmJ1eWVyQWRkcmVzcyAhPT0gdGhpcy53YWxsZXRDb25uZWN0LndhbGxldEFkZHJlc3MpIHtcbiAgICAgIHRoaXMudWkuaW5uZXJIVE1MID0gYDxoND5BY2NlcHQgc3dhcDwvaDQ+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJhbGVydCBhbGVydC13YXJuaW5nXCIgcm9sZT1cImFsZXJ0XCI+VGhpcyBzd2FwIGNhbiBvbmx5IGJlIGFjY2VwdGVkIGJ5IHRoZSBmb2xsb3dpbmcgd2FsbGV0Ojxicj48c3BhbiBzdHlsZT1cIndvcmQtYnJlYWs6IGJyZWFrLWFsbDtcIj4ke3RoaXMuZmllbGRzLmJ1eWVyQWRkcmVzc308L3NwYW4+PC9kaXY+YDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy51aS5pbm5lckhUTUwgPSBgPGg0PkFjY2VwdCBzd2FwPC9oND5cbiAgICAgICAgTG9hZGluZy4uLmA7XG5cbiAgICAgIHRoaXMuc3dhcExpbmtNYW5hZ2VyID0gbmV3IFN3YXBMaW5rTWFuYWdlcihcbiAgICAgICAgdGhpcy53YWxsZXRDb25uZWN0LFxuICAgICAgICB0aGlzLmFsZ29kQ2xpZW50LFxuICAgICAgICB0aGlzLmFsZ29JbmRleGVyXG4gICAgICApO1xuICAgICAgdGhpcy5nZW5lcmF0ZVRyYW5zYWN0aW9ucygpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGdlbmVyYXRlVHJhbnNhY3Rpb25zKCkge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLnN3YXBMaW5rTWFuYWdlci5nZW5lcmF0ZVRyYW5zYWN0aW9ucyh0aGlzLmZpZWxkcyk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICB0aGlzLnVpLmlubmVySFRNTCA9IGA8aDQ+QWNjZXB0IHN3YXA8L2g0PlxuICAgICAgICA8ZGl2IGNsYXNzPVwiYWxlcnQgYWxlcnQtZGFuZ2VyXCIgcm9sZT1cImFsZXJ0XCI+JHtlcnIubWVzc2FnZX08L2Rpdj5gO1xuICAgIH1cblxuICAgIHRoaXMuZGlzcGxheVVJKCk7XG4gIH1cblxuICBkaXNwbGF5VUkoKSB7XG4gICAgLy9hZGQgcm95YWx0aWVzIGlmIG5lZWRlZFxuICAgIGNvbnN0IHRyYW5zYWN0aW9ucyA9IHRoaXMuc3dhcExpbmtNYW5hZ2VyLnRyYW5zYWN0aW9ucztcblxuICAgIGNvbnN0IGFzc2V0SWRzID0gdHJhbnNhY3Rpb25zLmFzc2V0VHJhbnNmZXJzLm1hcCgodHgpID0+IHR4LmFzc2V0SW5kZXgpO1xuICAgIGNvbnN0IGJ1eWVyQWRkcmVzcyA9IGFsZ29zZGsuZW5jb2RlQWRkcmVzcyhcbiAgICAgIHRyYW5zYWN0aW9ucy5hc3NldFRyYW5zZmVyc1swXS50by5wdWJsaWNLZXlcbiAgICApO1xuICAgIGNvbnN0IHNlbGxlckFkZHJlc3MgPSBhbGdvc2RrLmVuY29kZUFkZHJlc3MoXG4gICAgICB0cmFuc2FjdGlvbnMuYXNzZXRUcmFuc2ZlcnNbMF0uZnJvbS5wdWJsaWNLZXlcbiAgICApO1xuXG4gICAgbGV0IHByaWNlTEkgPSBcIlwiO1xuXG4gICAgaWYgKHRyYW5zYWN0aW9ucy5wYXltZW50KSB7XG4gICAgICBsZXQgcHJpY2UgPSB0cmFuc2FjdGlvbnMucGF5bWVudC5hbW91bnQ7XG4gICAgICBsZXQgY3VycmVuY3lTdHJpbmc7XG5cbiAgICAgIGlmICh0cmFuc2FjdGlvbnMucGF5bWVudC50eXBlID09PSBcInBheVwiKSB7XG4gICAgICAgIC8vY29udmVydCBtaWNyb2FsZ28gdG8gYWxnb1xuICAgICAgICBwcmljZSA9IHByaWNlIC8gMTAwMDAwMDtcbiAgICAgICAgY3VycmVuY3lTdHJpbmcgPSBcIkFMR09cIjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxldCBlbW9qaSA9IFwiXCI7XG5cbiAgICAgICAgaWYgKHRoaXMuc3dhcExpbmtNYW5hZ2VyLmN1cnJlbmN5QXNzZXQuaW5kZXggPT09IDM2MDAxOTEyMikge1xuICAgICAgICAgIGVtb2ppID0gXCImIzEyNzg0NDsgXCI7XG4gICAgICAgIH1cblxuICAgICAgICBjdXJyZW5jeVN0cmluZyA9IGAke3RoaXMuc3dhcExpbmtNYW5hZ2VyLmN1cnJlbmN5QXNzZXQucGFyYW1zW1widW5pdC1uYW1lXCJdfSAke2Vtb2ppfShBU0EgJHt0aGlzLnN3YXBMaW5rTWFuYWdlci5jdXJyZW5jeUFzc2V0LmluZGV4fSlgO1xuICAgICAgfVxuXG4gICAgICBwcmljZUxJID0gYDxsaT5Zb3UnbGwgc2VuZCA8c3BhbiBjbGFzcz1cInByaWNlXCI+JHtwcmljZX0gJHtjdXJyZW5jeVN0cmluZ308L3NwYW4+PGJyPlxuICAgICAgPHNwYW4gY2xhc3M9XCJ3YWxsZXQtaW5mb1wiPlRPICR7c2VsbGVyQWRkcmVzc308L3NwYW4+PC9saT5gO1xuICAgIH1cblxuICAgIGNvbnN0IGFzc2V0TGlzdCA9IHRoaXMuc3dhcExpbmtNYW5hZ2VyLmFzc2V0cy5tYXAoKGFzc2V0KSA9PiB7XG4gICAgICByZXR1cm4gYDxzdHJvbmc+PGEgaHJlZj1cImh0dHBzOi8vd3d3Lm5mdGV4cGxvcmVyLmFwcC9hc3NldC8ke2Fzc2V0LmluZGV4fVwiIHRhcmdldD1cIl9ibGFua1wiPiR7YXNzZXQuaW5kZXh9PC9hPjwvc3Ryb25nPiAoJHthc3NldC5wYXJhbXMubmFtZX0pYDtcbiAgICB9KTtcblxuICAgIHRoaXMudWkuaW5uZXJIVE1MID0gYDxoND5BY2NlcHQgc3dhcDwvaDQ+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJyb3dcIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtbWQtNlwiPlxuICAgICAgICAgICAgICA8dWw+XG4gICAgICAgICAgICAgICAgJHtwcmljZUxJfVxuICAgICAgICAgICAgICAgIDxsaT5Zb3UnbGwgcmVjZWl2ZSBhc3NldCR7XG4gICAgICAgICAgICAgICAgICBhc3NldExpc3QubGVuZ3RoID4gMSA/IFwic1wiIDogXCJcIlxuICAgICAgICAgICAgICAgIH0gJHthc3NldExpc3Quam9pbihcIiwgXCIpfTwvbGk+XG4gICAgICAgICAgICAgIDwvdWw+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtbWQtNiBcIj5cbiAgICAgICAgICAgICAgICA8aW1nIHNyYz1cImRlZmF1bHQucG5nXCIgaWQ9XCJpbWdBc3NldFByZXZpZXdcIiBjbGFzcz1cImltZy1mbHVpZFwiPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8Zm9ybT5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJtYi0zIGZvcm0tY2hlY2tcIj5cbiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT1cImNoZWNrYm94XCIgY2xhc3M9XCJmb3JtLWNoZWNrLWlucHV0XCIgaWQ9XCJjaGVja0FjY2VwdFJpc2tcIiByZXF1aXJlZD5cbiAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9XCJmb3JtLWNoZWNrLWxhYmVsXCIgZm9yPVwiY2hlY2tBY2NlcHRSaXNrXCI+SSBhY2NlcHQgdG8gdXNlIHRoaXMgdG9vbCBhdCBteSBvd25cbiAgICAgICAgICAgICAgICAgICAgcmlzazwvbGFiZWw+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPVwic3VibWl0XCIgY2xhc3M9XCJidG4gYnRuLWdlbmVyYXRlIGZ3LWJvbGRcIiBpZD1cImJ1dHRvbkFjY2VwdFwiPkFjY2VwdCAmIHNpZ248L2J1dHRvbj5cbiAgICAgICAgPC9mb3JtPmA7XG5cbiAgICB0aGlzLnVpXG4gICAgICAucXVlcnlTZWxlY3RvcihcImZvcm1cIilcbiAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIHRoaXMuc3VibWl0QWNjZXB0LmJpbmQodGhpcykpO1xuXG4gICAgaWYgKHRyYW5zYWN0aW9ucy5yb3lhbHRpZXNQYXltZW50KSB7XG4gICAgICBjb25zdCBsaXN0UHJldmlldyA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcInVsXCIpO1xuICAgICAgY29uc3Qgcm95YWx0aWVzUG9pbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGlcIik7XG5cbiAgICAgIGxldCByb3lhbHRpZXNBbW91bnQgPSB0cmFuc2FjdGlvbnMucm95YWx0aWVzUGF5bWVudC5hbW91bnQ7XG4gICAgICBsZXQgY3VycmVuY3k7XG5cbiAgICAgIGlmICh0cmFuc2FjdGlvbnMucm95YWx0aWVzUGF5bWVudC50eXBlID09PSBcInBheVwiKSB7XG4gICAgICAgIC8vY29udmVydCBtaWNyb2FsZ28gdG8gYWxnb1xuICAgICAgICByb3lhbHRpZXNBbW91bnQgPSByb3lhbHRpZXNBbW91bnQgLyAxMDAwMDAwO1xuICAgICAgICBjdXJyZW5jeSA9IFwiQUxHT1wiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY3VycmVuY3kgPSB0cmFuc2FjdGlvbnMucm95YWx0aWVzUGF5bWVudC5hc3NldEluZGV4O1xuICAgICAgfVxuXG4gICAgICBjb25zdCBjcmVhdG9yQWRkcmVzcyA9IGFsZ29zZGsuZW5jb2RlQWRkcmVzcyhcbiAgICAgICAgdHJhbnNhY3Rpb25zLnJveWFsdGllc1BheW1lbnQudG8ucHVibGljS2V5XG4gICAgICApO1xuXG4gICAgICByb3lhbHRpZXNQb2ludC5pbm5lckhUTUwgPSBgWW91J2xsIHNlbmQgPHNwYW4gY2xhc3M9XCJwcmljZVwiPiR7cm95YWx0aWVzQW1vdW50fSAke2N1cnJlbmN5fTwvc3Bhbj4gdG8gYXNzZXQncyBjcmVhdG9yICYjMTI4MTU0Ozxicj5cbiAgICAgIDxzcGFuIGNsYXNzPVwid2FsbGV0LWluZm9cIj5UTyAke2NyZWF0b3JBZGRyZXNzfTwvc3Bhbj5gO1xuXG4gICAgICBsaXN0UHJldmlldy5hcHBlbmQocm95YWx0aWVzUG9pbnQpO1xuICAgIH1cblxuICAgIC8vbG9hZCBhc3NldCBpbWF6Z2VcbiAgICBsb2FkQXNzZXRJbWFnZShhc3NldElkc1swXSwgdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2ltZ0Fzc2V0UHJldmlld1wiKSwgNTEyKTtcbiAgfVxuXG4gIGFzeW5jIHN1Ym1pdEFjY2VwdChldmVudCkge1xuICAgIC8vY2FuY2VsIGRlZmF1bHQgYmVoYXZpb3VyIHdoZW4gc3VibWl0aW5nIGEgZm9ybVxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICBjb25zdCBidXR0b25BY2NlcHQgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjYnV0dG9uQWNjZXB0XCIpO1xuICAgIGJ1dHRvbkFjY2VwdC5kaXNhYmxlZCA9IHRydWU7XG4gICAgYnV0dG9uQWNjZXB0LmlubmVySFRNTCA9IGA8c3BhbiBjbGFzcz1cInNwaW5uZXItYm9yZGVyIHNwaW5uZXItYm9yZGVyLXNtXCIgcm9sZT1cInN0YXR1c1wiIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPjwvc3Bhbj5cbiAgICBXYWl0aW5nIGZvciBzaWduYXR1cmVzLi4uYDtcblxuICAgIC8qaWYgKHRoaXMud2FsbGV0Q29ubmVjdC53YWxsZXRUeXBlID09PSBcInBlcmFcIikge1xuICAgICAgdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI3NpZ24taW5mb1wiKS5pbm5lckhUTUwgPSBgXG4gICAgICA8ZGl2IGNsYXNzPVwiYWxlcnQgYWxlcnQtcHJpbWFyeSBkLWZsZXggYWxpZ24taXRlbXMtY2VudGVyXCIgcm9sZT1cImFsZXJ0XCI+XG4gICAgICAgICAgPHN2ZyB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgd2lkdGg9XCIxNlwiIGhlaWdodD1cIjE2XCIgZmlsbD1cImN1cnJlbnRDb2xvclwiIGNsYXNzPVwiYmkgYmktcGhvbmVcIiB2aWV3Qm94PVwiMCAwIDE2IDE2XCI+XG4gICAgICAgICAgPHBhdGggZD1cIk0xMSAxYTEgMSAwIDAgMSAxIDF2MTJhMSAxIDAgMCAxLTEgMUg1YTEgMSAwIDAgMS0xLTFWMmExIDEgMCAwIDEgMS0xaDZ6TTUgMGEyIDIgMCAwIDAtMiAydjEyYTIgMiAwIDAgMCAyIDJoNmEyIDIgMCAwIDAgMi0yVjJhMiAyIDAgMCAwLTItMkg1elwiLz5cbiAgICAgICAgICA8cGF0aCBkPVwiTTggMTRhMSAxIDAgMSAwIDAtMiAxIDEgMCAwIDAgMCAyelwiLz5cbiAgICAgICAgICA8L3N2Zz5cbiAgICAgICAgICBQbGVhc2Ugb3BlbiB5b3VyIFBlcmEgQWxnbyBXYWxsZXQgYXBwIHRvIHNpZ24uXG4gICAgICA8L2Rpdj5gO1xuICAgIH0qL1xuXG4gICAgdGhpcy5zd2FwTGlua01hbmFnZXIuc2lnbkFuZENvbW1pdFRyYW5zYWN0aW9ucyhcbiAgICAgIHRoaXMuc2lnbmVkVHJhbnNmZXJUeHMsXG4gICAgICB0aGlzLnNpZ25lZE9wdGluQ3VycmVuY3lUeCxcbiAgICAgICgpID0+IHtcbiAgICAgICAgLy9zaWduZWRcbiAgICAgICAgLy90aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjc2lnbi1pbmZvXCIpLnRleHRDb250ZW50ID0gJyc7XG4gICAgICAgIGJ1dHRvbkFjY2VwdC5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9XCJzcGlubmVyLWJvcmRlciBzcGlubmVyLWJvcmRlci1zbVwiIHJvbGU9XCJzdGF0dXNcIiBhcmlhLWhpZGRlbj1cInRydWVcIj48L3NwYW4+XG4gICAgICAgIFNlbmRpbmcgdHJhbnNhY3Rpb25zLi4uYDtcbiAgICAgIH0sXG4gICAgICAoKSA9PiB7XG4gICAgICAgIC8vc3VjY2Vzc1xuICAgICAgICBidXR0b25BY2NlcHQuaGlkZGVuID0gdHJ1ZTtcblxuICAgICAgICBjb25zdCBhc3NldExpc3QgPSB0aGlzLnN3YXBMaW5rTWFuYWdlci5hc3NldHMubWFwKChhc3NldCkgPT4ge1xuICAgICAgICAgIHJldHVybiBgPGEgaHJlZj1cImh0dHBzOi8vd3d3Lm5mdGV4cGxvcmVyLmFwcC9hc3NldC8ke2Fzc2V0LmluZGV4fVwiIHRhcmdldD1cIl9ibGFua1wiPiR7YXNzZXQuaW5kZXh9PC9hPiAoJHthc3NldC5wYXJhbXMubmFtZX0pYDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy51aS5pbm5lckhUTUwgPSBgPGg0PlN3YXBwZWQg8J+lszwvaDQ+XG4gICAgICAgIFlvdSByZWNlaXZlZCBhc3NldCR7YXNzZXRMaXN0Lmxlbmd0aCA+IDEgPyBcInNcIiA6IFwiXCJ9ICR7YXNzZXRMaXN0LmpvaW4oJywgJyl9LmA7XG4gICAgICB9LFxuICAgICAgKGVycikgPT4ge1xuICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG5cbiAgICAgICAgLy9mYWlsZWRcbiAgICAgICAgYnV0dG9uQWNjZXB0LmhpZGRlbiA9IHRydWU7XG5cbiAgICAgICAgdGhpcy51aS5pbm5lckhUTUwgPSBgPGg0PkFjY2VwdCBzd2FwPC9oND5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJhbGVydCBhbGVydC1kYW5nZXJcIiByb2xlPVwiYWxlcnRcIj5FcnJvcjo8YnI+JHtlcnJ9PC9kaXY+YDtcbiAgICAgIH1cbiAgICApO1xuICB9XG59XG4iXSwibmFtZXMiOlsiU3dhcExpbmtBY2NlcHQiLCJjb25zdHJ1Y3RvciIsInN3YXBEYXRhIiwid2FsbGV0Q29ubmVjdCIsImFsZ29kQ2xpZW50IiwiYWxnb0luZGV4ZXIiLCJ0aGlzIiwidWkiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJmaWVsZHMiLCJzaWduZWRUcmFuc2ZlclR4cyIsInNpZ25lZE9wdGluQ3VycmVuY3lUeCIsInJlc29sdmVEYXRhIiwiYXN5bmMiLCJkZWNvZGVkRGF0YSIsImF0b2IiLCJqc29uRGF0YSIsIkpTT04iLCJwYXJzZSIsImNvbnNvbGUiLCJsb2ciLCJtYXAiLCJ0eCIsImRlY29kZWRTaWduZWRUcmFuc2FjdGlvbnMiLCJhc3NldElkcyIsInR4biIsImFzc2V0SW5kZXgiLCJzZWxsZXJBZGRyZXNzIiwiZnJvbSIsInB1YmxpY0tleSIsImJ1eWVyQWRkcmVzcyIsInRvIiwicHJpY2UiLCJjdXJyZW5jeSIsInJveWFsdGllcyIsImdyb3VwSUQiLCJncm91cCIsImZpcnN0Um91bmQiLCJsYXN0Um91bmQiLCJzdGF0dXMiLCJkbyIsImlubmVySFRNTCIsIndhbGxldEFkZHJlc3MiLCJzd2FwTGlua01hbmFnZXIiLCJnZW5lcmF0ZVRyYW5zYWN0aW9ucyIsImVyciIsIm1lc3NhZ2UiLCJkaXNwbGF5VUkiLCJ0cmFuc2FjdGlvbnMiLCJhc3NldFRyYW5zZmVycyIsInByaWNlTEkiLCJwYXltZW50IiwiY3VycmVuY3lTdHJpbmciLCJhbW91bnQiLCJ0eXBlIiwiZW1vamkiLCJjdXJyZW5jeUFzc2V0IiwiaW5kZXgiLCJwYXJhbXMiLCJhc3NldExpc3QiLCJhc3NldHMiLCJhc3NldCIsIm5hbWUiLCJsZW5ndGgiLCJqb2luIiwicXVlcnlTZWxlY3RvciIsImFkZEV2ZW50TGlzdGVuZXIiLCJzdWJtaXRBY2NlcHQiLCJiaW5kIiwicm95YWx0aWVzUGF5bWVudCIsImxpc3RQcmV2aWV3Iiwicm95YWx0aWVzUG9pbnQiLCJyb3lhbHRpZXNBbW91bnQiLCJjcmVhdG9yQWRkcmVzcyIsImFwcGVuZCIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJidXR0b25BY2NlcHQiLCJkaXNhYmxlZCIsInNpZ25BbmRDb21taXRUcmFuc2FjdGlvbnMiLCJoaWRkZW4iLCJlcnJvciJdLCJzb3VyY2VSb290IjoiIn0=